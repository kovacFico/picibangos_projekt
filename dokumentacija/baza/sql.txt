CREATE TABLE KARTA
(
  id SERIAL PRIMARY KEY,
  snaga INT NOT NULL,
  kategorija VARCHAR(16) NOT NULL,
  tip VARCHAR(16) NOT NULL,
  naziv VARCHAR(64) NOT NULL,
  slika BYTEA NOT NULL
);

CREATE TABLE LOKACIJA
(
  opis VARCHAR(512) NOT NULL,
  slika BYTEA NOT NULL,
  id SERIAL PRIMARY KEY,
  naziv VARCHAR(40) NOT NULL,
  tip VARCHAR(15) NOT NULL,
  atribut FLOAT NOT NULL,
  geogVisina VARCHAR(32) NOT NULL,
  geogSirina VARCHAR(32) NOT NULL,
  idKarta SERIAL NOT NULL,
  FOREIGN KEY (idKarta) REFERENCES KARTA(id)
);

CREATE TABLE KORISNIK
(
  slika BYTEA NOT NULL,
  lozinka VARCHAR(256) NOT NULL,
  id SERIAL PRIMARY KEY,
  korisnickoIme VARCHAR(32) NOT NULL,
  email VARCHAR(64) NOT NULL,
  verificiran VARCHAR(2) NOT NULL,
  uloga VARCHAR(20) NOT NULL,
  UNIQUE (korisnickoIme)
);

CREATE TABLE KARTOGRAF
(
  iban VARCHAR(21) NOT NULL,
  slikaOsobne BYTEA NOT NULL,
  id SERIAL PRIMARY KEY,
  FOREIGN KEY (id) REFERENCES KORISNIK(id)
);

CREATE TABLE IGRAC
(
  elo INT NOT NULL,
  brojBorbi INT NOT NULL,
  brojPaketa INT NOT NULL,
  suspenzija TIMESTAMP NOT NULL,
  id SERIAL PRIMARY KEY,
  FOREIGN KEY (id) REFERENCES KORISNIK(id)
);

CREATE TABLE IGRAC_KARTA
(
  trajnost INT NOT NULL,
  idIgrac SERIAL NOT NULL,
  idKarta SERIAL NOT NULL,
  PRIMARY KEY (idIgrac, idKarta),
  FOREIGN KEY (idIgrac) REFERENCES IGRAC(id),
  FOREIGN KEY (idKarta) REFERENCES KARTA(id)
);

CREATE TABLE BORBA
(
  datumVrijeme TIMESTAMP NOT NULL,
  elo1 INT NOT NULL,
  elo2 INT NOT NULL,
  id SERIAL PRIMARY KEY,
  brojPobjedaRundi1 INT NOT NULL,
  brojPobjedaRundi2 INT NOT NULL,
  id1 SERIAL NOT NULL,
  id2 SERIAL NOT NULL,
  FOREIGN KEY (id1) REFERENCES IGRAC(id),
  FOREIGN KEY (id2) REFERENCES IGRAC(id)
);

CREATE TABLE AKTIVNA_BORBA
(
  id SERIAL PRIMARY KEY,
  brojPobjedaRundi1 INT NOT NULL,
  brojPobjedaRundi2 INT NOT NULL,
  fazaRunde VARCHAR(16) NOT NULL,
  id1 SERIAL NOT NULL,
  id2 SERIAL NOT NULL,
  FOREIGN KEY (id1) REFERENCES IGRAC(id),
  FOREIGN KEY (id2) REFERENCES IGRAC(id)
);

CREATE TABLE KARTE_U_BORBI
(
  brojIgraca VARCHAR(1) NOT NULL,
  statusKarte VARCHAR(16) NOT NULL,
  id SERIAL PRIMARY KEY,
  idBorba SERIAL NOT NULL,
  idKarta SERIAL NOT NULL,
  FOREIGN KEY (idBorba) REFERENCES AKTIVNA_BORBA(id),
  FOREIGN KEY (idKarta) REFERENCES KARTA(id)
);

CREATE TABLE PRIJAVA
(
  id SERIAL PRIMARY KEY,
  naziv VARCHAR(64) NOT NULL,
  slika BYTEA NOT NULL,
  atribut FLOAT NOT NULL,
  tip VARCHAR(16) NOT NULL,
  opis VARCHAR(512) NOT NULL,
  geogVisina VARCHAR(32) NOT NULL,
  geogSirina VARCHAR(32) NOT NULL,
  idIgrac SERIAL NOT NULL,
  FOREIGN KEY (idIgrac) REFERENCES IGRAC(id)
);
